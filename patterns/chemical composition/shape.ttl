@prefix rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix sh:    <http://www.w3.org/ns/shacl#> .
@prefix xsd:   <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
@prefix ex:    <http://www.example.org/#> .
@prefix owl:   <http://www.w3.org/2002/07/owl#> .
@prefix obo:    <http://purl.obolibrary.org/obo/> .
@prefix pmd:   <https://w3id.org/pmd/co/> .
@prefix shape:   <https://w3id.org/pmd/co/shapes> .

#TODO feature, write SPARQL queries to check if, e.g., proportions are correct classes
#TODO feature write or statements for the fractions being relational qualtities of material and pure chemical elements
shape: 
    a owl:Ontology ;
    owl:imports sh: ;
    owl:imports pmd: ;

	sh:declare [
		sh:prefix "sh" ;
		sh:namespace "http://www.w3.org/ns/shacl#"^^xsd:anyURI ;
	] .

# See Frame 351 on Miro, chemical composition (reworked after hackathon 2025)

shape:chemical_composition
    a sh:NodeShape ;
    sh:targetClass  pmd:PMD_0000551 ;  #'Chemical Composition'
    sh:property [            
        sh:path obo:RO_0000080 ; # quality of
        sh:class pmd:PMD_0000000 ; # material
    ] ;
    sh:property [            
        sh:path obo:RO_0000059 ;  # concretizes
        # sh:class pmd:PMD_0025002 ; # chemical composition specification
        sh:node shape:chemical_composition_specification ;
    ] ;
    sh:closed true ;
    # we also have to ignore RO_0000052 because it is superprop of RO_0000080 and reasoning brings it in
    sh:ignoredProperties ( rdf:type owl:topDataProperty owl:topObjectProperty obo:RO_0000052) .

shape:chemical_composition_specification
    rdf:type sh:NodeShape ; 
    sh:description "an instance of chemical composition specification has at least one member instance of fraction value specification. " ;
    sh:targetClass pmd:PMD_0025002 ; #chemical composition specification
    sh:property [
        sh:path obo:RO_0002351 ; # has member
        sh:node shape:fraction_value_specification ;
        sh:minCount 1 ;
    ] ;
    sh:closed false ;
    # not closing the shape because of inverse of conctretizes
    sh:ignoredProperties ( rdf:type owl:topDataProperty owl:topObjectProperty ) .

shape:proportion 
    rdf:type sh:NodeShape ; 
    sh:description "an instance of proportion (mass/molar/volume) concretizes an instance of scalar value specification. " ;
    sh:targetClass pmd:PMD_0020101 ;  # proportion (mass, volume , molar)
    sh:property [
        sh:path obo:RO_0000059 ; #concretizes
        sh:minCount 1 ; 
        sh:maxCount 1 ; 
        sh:node shape:fraction_value_specification ;
    ] ;
    sh:property [
        sh:path pmd:PMD_0025999 ; # relational quality of
        sh:minCount 1 ; 
        sh:class pmd:PMD_0000001 ; # portion of matter TODO:separate between material and chemical elements
    ] ;
    sh:closed true ;
    sh:ignoredProperties ( rdf:type owl:topDataProperty owl:topObjectProperty ) .

shape:pure_substance_chemical_element
    rdf:type sh:NodeShape ;
    sh:description "an instance of pure substance (any chemical element) has relational quality an instance of proportion. " ;
    sh:targetClass pmd:PMD_0020140 ; # portion of single chemical element
    sh:property [
        sh:path pmd:PMD_0025998 ; # has relational quality
        sh:node shape:proportion  ;
    ] ;
    sh:property [
        sh:path obo:BFO_0000050 ; # part of
        sh:class pmd:PMD_0000000  ; # material
    ] ;
    sh:property [
        sh:path [sh:inversePath obo:OBI_0001927 ] ; # specifies value of
        sh:node shape:fraction_value_specification ;
    ] ;
    
    sh:closed true ;

    # with inverse(OBI_0001927) reasoning brings in is subject of (PMD_0000004), so we have to ignore it
    sh:ignoredProperties ( rdf:type owl:topDataProperty owl:topObjectProperty pmd:PMD_0000004) .




