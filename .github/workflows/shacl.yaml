name: shacl validation

on:
  push:
    branches:
    - main
jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        ref: main
        path: main
    - name: Validate against SHACL shapes
      run: |
           pip install pyshacl

           curl -L -o robot.jar "https://github.com/ontodev/robot/releases/latest/download/robot.jar"
           #java -jar robot.jar --version

           # merge the current EDIT version and all components into one ontology file
           java -jar robot.jar  merge --catalog main/src/ontology/catalog-v001.xml --input main/src/ontology/pmdco-edit.owl --output merged-pmdco.ttl


           for DIR in main/patterns/*/     
           do  
               echo "processing: $DIR"

               SHAPEFILE="'${DIR}shape.ttl'"
               DATAFILE="'${DIR}shape-data.ttl'"

               java -jar robot.jar merge --collapse-import-closure false --input merged-pmdco.ttl --input $DATAFILE reason  --reasoner hermit --output shape-data-reasoned.ttl
               python3 -m pyshacl  -s $SHAPEFILE shape-data-reasoned.ttl
           done
